<div class="flex justify-between items-center my-5">
    <div>
        <p-iconfield>
            <p-inputicon class="ph ph-magnifying-glass" />
            <input class="max-w-32 lg:max-w-full" type="text" pInputText placeholder="Search"
                [formControl]="searchControl" />
        </p-iconfield>
    </div>
    <div class="flex gap-2">
        <a [routerLink]="['recall']">
            <p-button icon="ph ph-play" size="small" label="Recall"></p-button>
        </a>
        <p-button size="small" icon="ph ph-plus" label="New" (onClick)="isCreateDialogOpen.set(true)">
        </p-button>
    </div>
</div>

@if (loading()) {
<div class="flex flex-col justify-center items-center h-full">
    <app-loading-spinner />
</div>
}
@else {
@if (!error() && flashcards().length > 0) {
<p-scrollPanel class="h-4/5">
    @for (flashcard of flashcards(); track flashcard.id) {
    <div class="bg-slate-700 p-3 rounded-lg mb-3">
        <div class="flex justify-between">
            <div class="flex gap-2">
                <p-tag [severity]="
                    (flashcard.grade === 'Again' || flashcard.grade === 'Hard') ? 'danger' 
                    : (flashcard.grade === 'Easy') ? 'success' 
                    : 'warning'" pTooltip="Grade" tooltipPosition="top">
                    <i class="ph ph-gauge"></i>
                    {{ getGradeLabel(flashcard.grade) }}
                </p-tag>
                @let recallDate = dayjs(flashcard.nextRecall);
                @let isOverdue = recallDate < dayjs.utc(); <p-tag [severity]="isOverdue ? 'danger' : 'info'"
                    pTooltip="Next recall" tooltipPosition="top">
                    <i class="ph ph-clock"></i>

                    @if (isOverdue) { Overdue } @else { {{ recallDate.fromNow()
                    }} } </p-tag>
            </div>
            <div class="flex gap-2">
                <p-button (click)="selectedFlashcardId.set(flashcard.id); menu.toggle($event); $event.stopPropagation()"
                    severity="secondary" icon="ph ph-dots-three-vertical" />
            </div>
        </div>
        <div class="grid grid-cols-2 gap-2 mt-3 overflow-auto overflow-x-hidden">
            <div class="rounded-lg h-48">
                <quill-view [content]="flashcard.question" format="html" theme="snow" [sanitize]="true"></quill-view>
            </div>
            <div class="rounded-lg h-48">
                <quill-view [content]="flashcard.answer" format="html" theme="snow" [sanitize]="true"></quill-view>
            </div>
        </div>
    </div>
    }
</p-scrollPanel>
<p-paginator (onPageChange)="onPageChange($event)" [first]="first()" [rows]="pageSize()"
    [totalRecords]="metadata()?.totalElements" [rowsPerPageOptions]="[10, 20, 30]" [style]="{
                background: 'transparent'
            }">
</p-paginator>
} @else {
<div class="flex flex-col justify-center items-center h-3/4">
    <i class="ph ph-info" style="font-size: 32px"></i>
    <span class="font-semibold">No flashcards found.</span>
    <span>
        Start by creating a <span class="text-yellow-300">New</span> one
    </span>
</div>
}
}

<app-flashcard-form 
    type="CREATE" 
    [visible]="isCreateDialogOpen()" 
    (closed)="isCreateDialogOpen.set(false)"
    [collectionId]="collectionId" 
    (created)="reload()"
>
</app-flashcard-form>

<app-flashcard-form 
    type="UPDATE" 
    [visible]="isUpdateDialogOpen()" 
    (closed)="isUpdateDialogOpen.set(false)"
    [collectionId]="collectionId"
    [flashcardId]="selectedFlashcardId()" 
    (created)="reload()"
>
</app-flashcard-form>

<p-confirmDialog></p-confirmDialog>
<p-menu #menu [model]="options" [popup]="true" />